# Windows Deployment Provisioning

This project automates the creation and use of a Windows Provisioning Package (PPKG) for custom deployments. It leverages Windows Configuration Designer (WCD) and supporting PowerShell scripts to streamline setup, apply customizations, and integrate with Reset This PC and OOBE (Out Of Box Experience). 

## Features 

* Generates a `Provisioning.ppkg` using WCD’s ICD.exe  
* Prompts for automatic installation/uninstallation of Windows Configuration Designer
* Copies required provisioning DAT files automatically  
* Supports unattended deployment with custom unattend.xml  
* Executes custom user scripts, user registry keys, and environment variables from pre-defined directories during OOBE
     

## Repository Layout 
After running `InitializeProject.ps1`, `Provisioning.PPKG` will be created and placed inside `.\CopyContentsToRootOfUSB\`. 

        .
        ├── CopyContentsToRootOfUSB   
        ├── customizations.xml        # XML configuration imported by ICD.exe
        ├── InitializeProject.ps1     # Main automation script (elevates, installs WCD, builds PPKG, guides next steps)
        │
        └── CopyContentsToRootOfUSB/    # Contains some default example files; copy this folder’s contents to USB root
            ├── Provisioning.ppkg       # The provisioning package built via WCD (must be at USB root)
            ├── Provisioning.cat        # Catalog file generated by ICD.exe (required to validate/run .ppkg)
            ├── provision.ps1           # Core deployment script, invoked by provisioning package or manually run
            ├── unattend.xml            # Sysprep answer file; calls oobe.ps1 at FirstLogon
            ├── ResetConfig.xml         # Reset configuration file, hooks into Reset This PC
            ├── runcustomizations.cmd   # Called after reset, applies unattend and triggers customizations
            ├── oobe.ps1                # Runs OOBE scripts, registry imports, environment setup on first login
            ├── .env                    # Place custom environment variables to be used by the oobe.ps1 process during FirstLogon
            ├── oobe_scripts/           # Place custom executables/scripts (.exe, .cmd, .bat, .ps1) to run during FirstLogon
            └── reg/                    # Place .reg files here; imported automatically during FirstLogon
     
## Prerequisites 

* Windows 10 / 11  
* PowerShell (run scripts as Administrator)  
* Windows Configuration Designer (WCD)
  * `InitializeProject.ps1` prompts for installation of WCD
* Optional: winget for automatic package installs
     
## Initializing the Project
* Clone the Project

      git clone https://github.com/chrisdavedev/Custom-Windows-Deployment.git
      cd custom-windows-deployment

* Run the Initialization Script (will self elevate admin rights)

      powershell.exe -ExecutionPolicy Bypass -File InitializeProject.ps1

* Then follow the prompts:   
  * Installs WCD if missing  
  * Locates/copies the required DAT file  
  * Builds the Provisioning.ppkg package to `.\CopyContentsToRootOfUSB\`
  * INCOMING FEATURE: Prompts to copy required files to USB flash drive

* Once complete, copy the contents of `.\CopyContentsToRootOfUSB\` to the root of a USB drive. 
     

## Deployment Methods 

### Method 1 (During Setup)
* Insert the USB drive on the language screen in Windows Setup. The provisioning package will auto-run and call `provision.ps1`.
* Windows Setup will be skipped and 
     
### Method 2 (Post-Setup)
* On an already installed Windows system execute `.\provision.ps1` with administrator privileges.
* Follow the prompts
* Then run Reset This PC via: `Settings → Update & Security → Recovery → Reset This PC`
     

### Key Customization Files in CopyContentsToRootOfUSB/ 

* **oobe.ps1** → Executes all scripts, registry tweaks, and environment configs at OOBE  
* **.env** → Place custom Environment Variables for the oobe.ps1 process (not SYSTEM)
* **oobe_scripts/** → Place custom .ps1, .bat, .cmd, .exe to run at first login  
* **reg/** → Place .reg files to load into Windows Registry during OOBE       

## Important Notes ⚠️ 
* Running this project overwrites C:\Recovery.  
* This may break OEM factory recovery solutions.  
* Back up C:\Recovery before proceeding, especially on production systems.
        
